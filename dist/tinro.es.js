import{SvelteComponent as re,check_outros as ae,create_slot as ne,detach as oe,empty as le,group_outros as ie,init as ce,insert as se,safe_not_equal as ue,transition_in as k,transition_out as S,update_slot as fe}from"svelte/internal";import{getContext as I}from"svelte";import{writable as K}from"svelte/store";import{getContext as y,setContext as D,onMount as N,tick as O}from"svelte";import{writable as P}from"svelte/store";function v(t,a=!1){return t=t.slice(t.startsWith("/#")?2:0,t.endsWith("/*")?-2:void 0),t.startsWith("/")||(t="/"+t),t==="/"&&(t=""),a&&!t.endsWith("/")&&(t+="/"),t}function H(t,a){t=v(t,!0),a=v(a,!0);let n=[],r={},e=!0,o=t.split("/").map(l=>l.startsWith(":")?(n.push(l.slice(1)),"([^\\/]+)"):l).join("\\/"),i=a.match(new RegExp(`^${o}$`));return i||(e=!1,i=a.match(new RegExp(`^${o}`))),i?(n.forEach((l,p)=>r[l]=i[p+1]),{exact:e,params:r,part:i[0].slice(0,-1)}):null}function C(t,a,n){if(n==="")return t;if(n[0]==="/")return n;let r=i=>i.split("/").filter(l=>l!==""),e=r(t),o=a?r(a):[];return"/"+o.map((i,l)=>e[l]).join("/")+"/"+n}function g(t,a,n,r){let e=[a,"data-"+a].reduce((o,i)=>{let l=t.getAttribute(i);return n&&t.removeAttribute(i),l===null?o:l},!1);return!r&&e===""?!0:e||r||!1}function U(t){let a=t.split("&").map(n=>n.split("=")).reduce((n,r)=>{let e=r[0];if(!e)return n;let o=r.length>1?r[r.length-1]:!0;return typeof o=="string"&&o.includes(",")&&(o=o.split(",")),n[e]===void 0?n[e]=[o]:n[e].push(o),n},{});return Object.entries(a).reduce((n,r)=>(n[r[0]]=r[1].length>1?r[1]:r[1][0],n),{})}function Z(t){throw new Error("[Tinro] "+t)}var x=1,E=2,W=3,B=4;function G(t,a,n,r){return t===x?a&&a():t===E?n&&n():r&&r()}function J(){return!window||window.location.pathname==="srcdoc"?W:x}var f={HISTORY:x,HASH:E,MEMORY:W,OFF:B,run:G,getDeafault:J},A,w,m=Q();function Q(){let t=f.getDeafault(),a,n=o=>window.onhashchange=window.onpopstate=w=null,r=o=>a&&a(M(t));function e(o){o&&(t=o),n(),t!==f.OFF&&f.run(t,i=>window.onpopstate=r,i=>window.onhashchange=r)&&r()}return{mode:o=>e(o),get:o=>M(t),go(o){console.log("go(href)"),X(t,o),r()},replace(o){console.log("going to replace 3"),V(t,o),r()},start(o){a=o,e()},stop(){a=null,e(f.OFF)}}}function V(t,a){console.log("Replacing location"),f.run(t,n=>history.replaceState({},"",a),n=>window.location.hash=a,n=>w=a)}function X(t,a){console.log("SET LOCATION (new)"),f.run(t,n=>history.pushState({},"",a),n=>window.location.hash=a,n=>w=a)}function M(t){let a=A,n=A=f.run(t,e=>window.location.pathname+window.location.search,e=>String(window.location.hash.slice(1)||"/"),e=>w||"/"),r=n.match(/^([^?#]+)(?:\?([^#]+))?(?:\#(.+))?$/);return{url:n,from:a,path:r[1]||"",query:U(r[2]||""),hash:r[3]||""}}function q(t){let a=y("tinro");a&&(a.exact||a.fallback)&&Z(`${t.fallback?"<Route fallback>":`<Route path="${t.path}">`}  can't be inside ${a.fallback?"<Route fallback>":`<Route path="${a.path||"/"}"> with exact path`}`);let n=t.fallback?"fallbacks":"childs",r=P({}),e={router:{},exact:!1,pattern:null,meta:{},parent:a,fallback:t.fallback,redirect:!1,replace:!1,firstmatch:!1,breadcrumb:null,matched:!1,childs:new Set,activeChilds:new Set,fallbacks:new Set,update(o){e.exact=!o.path.endsWith("/*"),e.pattern=v(`${e.parent&&e.parent.pattern||""}${o.path}`),e.redirect=o.redirect,e.replace=o.replace,e.firstmatch=o.firstmatch,e.breadcrumb=o.breadcrumb,e.match()},register:()=>{if(e.parent)return e.parent[n].add(e),()=>{e.parent[n].delete(e),e.router.un&&e.router.un()}},show:()=>{t.onShow(),!e.fallback&&e.parent&&e.parent.activeChilds.add(e)},hide:()=>{t.onHide(),!e.fallback&&e.parent&&e.parent.activeChilds.delete(e)},match:async()=>{e.matched=!1;let{path:o,url:i,from:l,query:p}=e.router,s=H(e.pattern,o);if(console.log("route",e),!e.fallback&&s&&(e.redirect||e.replace)&&(!e.exact||e.exact&&s.exact)){await O();let u=C(o,e.parent&&e.parent.pattern,e.redirect);return e.redirect?(console.log("going going gone"),d.goto(u)):(console.log("in here redirect 1"),d.replaceWith(u))}if(e.meta=s&&{from:l,url:i,query:p,match:s.part,pattern:e.pattern,breadcrumbs:e.parent&&e.parent.meta&&e.parent.meta.breadcrumbs.slice()||[],params:s.params,subscribe:r.subscribe},e.breadcrumb&&e.meta&&e.meta.breadcrumbs.push({name:e.breadcrumb,path:s.part}),r.set(e.meta),s&&!e.fallback&&(!e.exact||e.exact&&s.exact)&&(!e.parent||!e.parent.firstmatch||!e.parent.matched)?(t.onMeta(e.meta),e.parent&&(e.parent.matched=!0),e.show()):e.hide(),await O(),s&&!e.fallback&&(e.childs.size>0&&e.activeChilds.size==0||e.childs.size==0&&e.fallbacks.size>0)){let u=e;for(;u.fallbacks.size==0;)if(u=u.parent,!u)return;u&&u.fallbacks.forEach(h=>{if(h.redirect||h.replace){let b=C("/",h.parent&&h.parent.pattern,h.redirect);h.redirect?(console.log("in here redirect 2"),console.log("going going gone"),d.goto(b)):(console.log("in here replace 2"),d.replaceWith(b))}else h.show()})}}};return D("tinro",e),N(()=>e.register()),e.router.un=d.subscribe(o=>{e.router.path=o.path,e.router.url=o.url,e.router.query=o.query,e.router.from=o.from,e.pattern!==null&&e.match()}),e}function R(){return y("tinro").meta}var d=$();function $(){let{subscribe:t}=K(m.get(),a=>{m.start(a),console.log("setting up some listener");let n=ee(m.go);return()=>{m.stop(),n()}});return{subscribe:t,goto:a=>m.go(a),replaceWith:a=>m.replace(a),params:te,meta:R,useHashNavigation:a=>m.mode(a?f.HASH:f.HISTORY),mode:{hash:()=>m.mode(f.HASH),history:()=>m.mode(f.HISTORY),memory:()=>m.mode(f.MEMORY)}}}function z(t){let a=g(t,"href"),n=g(t,"exact",!0),r=g(t,"active-class",!0,"active");return{destroy:d.subscribe(e=>{let o=H(a,e.path);o&&(o.exact&&n||!n)?t.classList.add(r):t.classList.remove(r)})}}function ee(t){let a=n=>{let r=n.target.closest("a[href]"),e=r&&g(r,"target",!1,"_self"),o=r&&g(r,"tinro-ignore"),i=n.ctrlKey||n.metaKey||n.altKey||n.shiftKey;if(e=="_self"&&!o&&!i&&r){let l=r.getAttribute("href").replace(/^\/#/,"");/^\/\/|^[a-zA-Z]+:/.test(l)||(n.preventDefault(),t(l.startsWith("/")?l:r.href.replace(window.location.origin,"")))}};return addEventListener("click",a),()=>removeEventListener("click",a)}function te(){return I("tinro").meta.params}var he=t=>({params:t&2,meta:t&4}),F=t=>({params:t[1],meta:t[2]});function T(t){let a,n=t[10].default,r=ne(n,t,t[9],F);return{c(){r&&r.c()},m(e,o){r&&r.m(e,o),a=!0},p(e,o){r&&r.p&&o&518&&fe(r,n,e,e[9],o,he,F)},i(e){a||(k(r,e),a=!0)},o(e){S(r,e),a=!1},d(e){r&&r.d(e)}}}function me(t){let a,n,r=t[0]&&T(t);return{c(){r&&r.c(),a=le()},m(e,o){r&&r.m(e,o),se(e,a,o),n=!0},p(e,[o]){e[0]?r?(r.p(e,o),o&1&&k(r,1)):(r=T(e),r.c(),k(r,1),r.m(a.parentNode,a)):r&&(ie(),S(r,1,1,()=>{r=null}),ae())},i(e){n||(k(r),n=!0)},o(e){S(r),n=!1},d(e){r&&r.d(e),e&&oe(a)}}}function de(t,a,n){let{$$slots:r={},$$scope:e}=a,{path:o="/*"}=a,{fallback:i=!1}=a,{redirect:l=!1}=a,{replace:p=!1}=a,{firstmatch:s=!1}=a,{breadcrumb:u=null}=a,h=!1,b={},_={},Y=q({fallback:i,onShow(){n(0,h=!0)},onHide(){n(0,h=!1)},onMeta(c){n(2,_=c),n(1,b=_.params)}});return t.$$set=c=>{"path"in c&&n(3,o=c.path),"fallback"in c&&n(4,i=c.fallback),"redirect"in c&&n(5,l=c.redirect),"replace"in c&&n(6,p=c.replace),"firstmatch"in c&&n(7,s=c.firstmatch),"breadcrumb"in c&&n(8,u=c.breadcrumb),"$$scope"in c&&n(9,e=c.$$scope)},t.$$.update=()=>{if(t.$$.dirty&488){e:Y.update({path:o,redirect:l,replace:p,firstmatch:s,breadcrumb:u})}},[h,b,_,o,i,l,p,s,u,e,r]}var j=class extends re{constructor(a){super();ce(this,a,de,me,ue,{path:3,fallback:4,redirect:5,replace:6,firstmatch:7,breadcrumb:8})}},L=j;export{L as Route,z as active,R as meta,d as router};
